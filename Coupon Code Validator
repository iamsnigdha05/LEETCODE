class Solution:
    def validateCoupons(self, code, businessLine, isActive):
        allowed_lines = ["electronics", "grocery", "pharmacy", "restaurant"]
        line_order = {line: i for i, line in enumerate(allowed_lines)}
        
        valid = []

        for i in range(len(code)):
             
            if not isActive[i]:
                continue

             
            c = code[i]
            if not c:
                continue
            for ch in c:
                if not (ch.isalnum() or ch == "_"):
                    break
            else:
                
                bl = businessLine[i]
                if bl in line_order:
                    valid.append((line_order[bl], c))

         
        valid.sort(key=lambda x: (x[0], x[1]))

        return [c for _, c in valid]
